## REDIS中字符串是如何实现的？

### 趁热打铁了，面试PHP还会有人问这个？反正我面试是至少两个人问过我，可能是我面试的岗位比较高端...

#### 字符串对象

* 字符串编码分为int,raw和embstr

* 如果字符串长度小于等于32字节,那就使用embstr编码(一次内存分配同时存放redisobject和sdshdr)否则使用raw编码(两次内存分配分别存放redisobject和sdshdr)

#### string类型:SDS

* 由使用长度,剩余容量,字符串(字符数组)组成

* 字符串部分与c语言相同,结尾都有'\0'标志且不计入长度,由于是二进制安全的(由于使用len存储存储长度,所以即便字符串中含有\0也不会截断),所以字符中的'\0'不会导致SDS中途截断,同时也会计入长度

* 可以有效杜绝缓冲区溢出问题,通过内存预分配减少字符串操作时申请内存的次数:字符长度低于1MB时,预分配会将长度加倍并+1个字节(byte)用于结尾的'\0'字符,大于1MB时会额外分配1MB+1个字节长度

* 字符长度减少时则使用惰性策略,不主动释放内存并使用剩余容量来记录剩余可用容量

* SDS是二进制安全的,不会限制数据的格式

