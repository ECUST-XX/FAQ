## REDIS中常见的数据结构有几种？在你看来每种数据结构的应用场景应该是怎样的？

### 这个问题算是一个初级问题，很多人直接都是从网上背诵了一波儿，背诵的用来应付前半个问题应该还是可以的，但是应付后半个问题就可能会捉襟见肘一些...所以，结合场景更有说服力

#### redis中的数据结构

* SDS简单动态字符串:由剩余空间大小free,字符长度len,数据区buf组成(字符串末尾同c语言为\0,不计入len);长度小于1MB时内存分配规则为原长度翻倍+1byte,大于1MB时为原长度+1MB+1byte;释放时多余空间不会主动回收,方便下次修改;二进制安全

* 双向链表:由list结构(节点个数,头节点指针,尾节点指针)和多个节点组成

* 字典:实际由两个哈希表组成(由dictht结构(哈希表大小,已使用哈希表节点数量,哈希表节点指针)和哈希表节点组成;当存在哈希冲突时使用单链表解决),当第一个哈希表负载因子过大或过小时都会使用第二个哈希表进行渐进式rehash,完成后便将原哈希表替换

* 跳跃表:由zskiplist(头节点指针,尾节点指针,节点最大层数和跳跃表长度)与zskiplistNode(层,后退指针,分值和成员对象)组成;有序;分值可以相同但成员对象必须唯一;分值相同时会以成员对象大小排序

* 整数集合:由编码方式(int16,int32,int64),元素数量和存储的数组组成;当更新元素时如果类型不匹配则会升级元素类型(不会降级),重新申请内存分配空间;是节约内存的顺序型数据结构

* 压缩列表:是一块连续的内存,主要由节点构成,非节点部分则记录了压缩列表信息,是节约内存的顺序型数据结构;非节点部分由总容量,起始点与尾节点字节数,节点数量,列表节点,0xFF(压缩列表结尾标志)组成;节点部分由前节点长度(1或5字节),节点编码(保存了数据类型与长度),节点内容组成;节点的更新可能会导致连锁更新,但出现几率不高

#### redis中的数据类型

* 由类型(redis的五种数据类型),编码(上述的数据结构与long类型整数),底层数据结构指针组成

* string 字符串对象:整数,embstr编码的SDS,SDS

* list 列表:压缩列表,链表

* hash 哈希表:压缩列表,字典

* set 集合(唯一):整数集合,字典

* Zset 有序集合(唯一有序):压缩列表,跳跃表与字典实现的有序集合

* redis数据库中的每个键值对的键和值都是一个对象

* 集合的返回是随机的,元素是唯一的

* 有序集合使用跳跃表和字典实现是为了使范围操作和查找都能快速执行

* redis只共享整数对象(默认0-9999),而不共享字符串对象因为字符串的比较需要消耗额外资源

* redis采用引用计数的方式来回收内存

* 对象会记录最后一次被访问时间,用于计算空转时间

#### 应用场景

* 其实一个微博或者论坛就可以使用redis提供的全部数据类型,访问量或者布隆过滤器用string,一篇文章的点赞数评论数浏览数可以打包放在hash里,消息推送可以用list做消息队列,或者时间轴也可以用list实现,用户关系可以用set做交并集处理,文章排名可以用zset

